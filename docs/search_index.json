[
["index.html", "Indicateurs de la Biodiversité 1 Dependencies", " Indicateurs de la Biodiversité Andrew MacDonald 2020-06-29 1 Dependencies library(rcoleo) library(tidyverse) library(lubridate) "],
["dl.html", "2 Download data 2.1 List of Indicators", " 2 Download data The only point here is to demonstrate the workflow for downloading data # On retire les cellules (classe sf) depuis l&#39;API cells &lt;- rcoleo::sf_cells() obs &lt;- rcoleo::get_obs() sites_dl &lt;- rcoleo::sf_sites() # until there is a better way to obtain the data and parse the result (perhaps # in the form of a convenience function in rcoleo) we do this: obs_df &lt;- obs[[1]] %&gt;% map(&quot;body&quot;) %&gt;% map_df(~ select(.x, -closed_at)) all_obs &lt;- obs_df %&gt;% select(cell_code, site_code, date_obs, type, taxa = obs_species.taxa_name, var = obs_species.variable, val = obs_species.value) %&gt;% mutate(date_obs = lubridate::ymd(date_obs), # convert cover into pres/abs (right?) count = if_else(var == &quot;recouvrement&quot;, 1, val)) # CELLULES: On compte le nombre d&#39;observation/nombre espece par type, année et cellule obs_cells &lt;- all_obs %&gt;% group_by(cell_code, date_obs, type) %&gt;% summarise(n = sum(count)) %&gt;% ungroup sp_cells &lt;- all_obs %&gt;% select(cell_code, date_obs, type, taxa) %&gt;% distinct() %&gt;% group_by(cell_code, date_obs, type) %&gt;% summarise(n = n()) %&gt;% ungroup # CAMPAGNES sites &lt;- sites_dl %&gt;% select(site_code, off_station_code_id, type_milieu = type, geometry, site_id = id) # On prépare les jeux de données pour chacun des types de campagnes all_obs_con &lt;- all_obs %&gt;% filter(taxa != &quot;inconnu&quot;) microfaunes &lt;- subset(all_obs_con, type == &quot;insectes_sol&quot;) papillons &lt;- subset(all_obs_con, type == &quot;papilionidés&quot;) odonates &lt;- subset(all_obs_con, type == &quot;odonates&quot;) vegetation &lt;- subset(all_obs_con, type == &quot;végétation&quot;) 2.0.1 overall summary all_obs_con %&gt;% group_by(type) %&gt;% summarize(sites = n_distinct(site_code), cells = n_distinct(cell_code), taxa = n_distinct(taxa)) ## `summarise()` ungrouping output (override with `.groups` argument) ## # A tibble: 4 x 4 ## type sites cells taxa ## &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; ## 1 insectes_sol 13 13 37 ## 2 odonates 12 10 35 ## 3 papilionidés 14 11 26 ## 4 végétation 26 11 170 2.1 List of Indicators Vitesse de décomposition de la matière organique Composition des communautés d’Odonates Phénologie végétale Phénologie acoustique des communautés, d’anoures et d’orthoptères Composition communauté d’insectes du sol Composition des communautés de poissons Présence de certains méso carnivores et grands mammifères Composition macroinvertébrés benthiques d’eau douce Composition des communautés des orthoptères "],
["sites.html", "3 Sites", " 3 Sites Summary data about the different sites obs_cells %&gt;% ggplot(aes(x = cell_code, y = n)) + geom_point() + facet_wrap(~type, scales = &quot;free_y&quot;) ## Warning: Removed 1 rows containing missing values (geom_point). "],
["odonate-communities.html", "4 Odonate communities 4.1 Questions", " 4 Odonate communities # confirm that the only variable recorded here is &quot;abondance&quot; odonates$var %&gt;% unique %&gt;% {stopifnot(. == &quot;abondance&quot;)} odonates %&gt;% glimpse %&gt;% {all.equal(.$count, .$val)} ## Rows: 151 ## Columns: 8 ## $ cell_code &lt;chr&gt; &quot;135_104&quot;, &quot;135_104&quot;, &quot;135_104&quot;, &quot;135_104&quot;, &quot;135_104&quot;, &quot;135… ## $ site_code &lt;chr&gt; &quot;135_104_H01&quot;, &quot;135_104_H01&quot;, &quot;135_104_H01&quot;, &quot;135_104_H01&quot;,… ## $ date_obs &lt;date&gt; 2016-06-23, 2016-06-23, 2016-06-23, 2016-06-23, 2016-06-23… ## $ type &lt;chr&gt; &quot;odonates&quot;, &quot;odonates&quot;, &quot;odonates&quot;, &quot;odonates&quot;, &quot;odonates&quot;,… ## $ taxa &lt;chr&gt; &quot;Leucorrhinia hudsonica&quot;, &quot;Nehalennia gracilis&quot;, &quot;Gomphus s… ## $ var &lt;chr&gt; &quot;abondance&quot;, &quot;abondance&quot;, &quot;abondance&quot;, &quot;abondance&quot;, &quot;abonda… ## $ val &lt;dbl&gt; 2, 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 4, 1, 10, 1, 30, 5, 20, 5,… ## $ count &lt;dbl&gt; 2, 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 4, 1, 10, 1, 30, 5, 20, 5,… ## [1] TRUE ## are sites nested in cells? odonates %&gt;% select(site_code, cell_code) %&gt;% distinct %&gt;% group_by(cell_code) %&gt;% tally ## # A tibble: 10 x 2 ## cell_code n ## &lt;chr&gt; &lt;int&gt; ## 1 132_116 1 ## 2 135_104 1 ## 3 137_107 1 ## 4 137_111 1 ## 5 139_103 1 ## 6 139_111 1 ## 7 141_108 1 ## 8 142_111 2 ## 9 145_102 2 ## 10 148_101 1 # yes, sometimes there are sites within cells! rank_abundance &lt;- odonates %&gt;% left_join(select(cells, cell_code, name)) %&gt;% group_by(cell_code, name, site_code, taxa) %&gt;% summarize(total = sum(count)) %&gt;% mutate(rank = row_number(desc(total))) ## Joining, by = &quot;cell_code&quot; ## `summarise()` regrouping output by &#39;cell_code&#39;, &#39;name&#39;, &#39;site_code&#39; (override with `.groups` argument) rank_abundance %&gt;% ggplot(aes(x = rank, y = total, group = site_code)) + geom_point() + geom_line() + facet_wrap(~name) + coord_trans(y = &quot;log&quot;) + theme_bw() 4.1 Questions Some sites appear to count individuals, not species? why is that? odonates %&gt;% left_join(select(cells, cell_code, name)) %&gt;% filter(name %&gt;% stringr::str_detect(&quot;Parc|-de-&quot;)) %&gt;% select(name, site_code, taxa, val) %&gt;% knitr::kable(.) ## Joining, by = &quot;cell_code&quot; name site_code taxa val La Côte-de-Beaupré 139_111_H01 Leucorrhinia glacialis 1 La Côte-de-Beaupré 139_111_H01 Ladona julia 1 La Côte-de-Beaupré 139_111_H01 Ladona julia 1 La Côte-de-Beaupré 139_111_H01 Ladona julia 1 La Côte-de-Beaupré 139_111_H01 Ladona julia 1 La Côte-de-Beaupré 139_111_H01 Ladona julia 1 La Côte-de-Beaupré 139_111_H01 Ladona julia 1 La Côte-de-Beaupré 139_111_H01 Ladona julia 1 La Côte-de-Beaupré 139_111_H01 Ladona julia 1 La Côte-de-Beaupré 139_111_H01 Ladona julia 1 La Côte-de-Beaupré 139_111_H01 Ladona julia 1 La Côte-de-Beaupré 139_111_H01 Enallagma ebrium 1 La Côte-de-Beaupré 139_111_H01 Ladona julia 1 La Côte-de-Beaupré 139_111_H01 Nehalennia irene 1 La Côte-de-Beaupré 139_111_H01 Leucorrhinia proxima 1 La Côte-de-Beaupré 139_111_H01 Dorocordulia libera 1 La Côte-de-Beaupré 139_111_H01 Enallagma ebrium 1 La Côte-de-Beaupré 139_111_H01 Ladona julia 1 La Côte-de-Beaupré 139_111_H01 Ladona julia 1 La Côte-de-Beaupré 139_111_H01 Somatochlora franklini 1 La Côte-de-Beaupré 139_111_H01 Enallagma ebrium 1 La Côte-de-Beaupré 139_111_H01 Ladona julia 1 La Côte-de-Beaupré 139_111_H01 Enallagma ebrium 1 La Côte-de-Beaupré 139_111_H01 Leucorrhinia proxima 1 La Côte-de-Beaupré 139_111_H01 Leucorrhinia proxima 1 La Côte-de-Beaupré 139_111_H01 Nehalennia irene 1 Parc Frontenac 145_102_H01 Nehalennia gracilis 1 Parc Frontenac 145_102_H01 Leucorrhinia proxima 1 Parc Frontenac 145_102_H01 Nannothemis bella 1 Parc Frontenac 145_102_H01 Nannothemis bella 1 Parc Frontenac 145_102_H01 Nehalennia gracilis 1 Parc Frontenac 145_102_H01 Nannothemis bella 1 Parc Frontenac 145_102_H01 Nehalennia irene 1 Parc Frontenac 145_102_H01 Nehalennia irene 1 Parc Frontenac 145_102_H01 Nehalennia gracilis 1 Parc Frontenac 145_102_H01 Enallagma boreale 1 Parc Frontenac 145_102_H01 Leucorrhinia patricia 1 Parc Frontenac 145_102_H01 Nehalennia irene 1 Parc Frontenac 145_102_H01 Leucorrhinia glacialis 1 Parc Frontenac 145_102_H02 Nehalennia irene 1 Parc Frontenac 145_102_H02 Celithemis elisa 1 Parc Frontenac 145_102_H02 Nehalennia irene 1 Parc Frontenac 145_102_H02 Leucorrhinia proxima 1 Parc Frontenac 145_102_H02 Ischnura posita 1 Parc Frontenac 145_102_H02 Enallagma ebrium 1 "],
["soil-invertebrates.html", "5 Soil invertebrates 5.1 Questions", " 5 Soil invertebrates # confirm that the only variable recorded here is &quot;abondance&quot; microfaunes$var %&gt;% unique %&gt;% {stopifnot(. == &quot;abondance&quot;)} ## are sites nested in cells? microfaunes %&gt;% select(site_code, cell_code) %&gt;% distinct %&gt;% group_by(cell_code) %&gt;% tally ## # A tibble: 13 x 2 ## cell_code n ## &lt;chr&gt; &lt;int&gt; ## 1 132_116 1 ## 2 135_104 1 ## 3 136_116 1 ## 4 137_107 1 ## 5 137_111 1 ## 6 139_103 1 ## 7 139_111 1 ## 8 141_108 1 ## 9 142_111 1 ## 10 145_102 1 ## 11 148_101 1 ## 12 48_181 1 ## 13 80_175 1 # no, here we have one survey per cell rank_abundance &lt;- microfaunes %&gt;% filter(val&gt;0) %&gt;% left_join(select(cells, cell_code, name)) %&gt;% group_by(cell_code, name, site_code) %&gt;% mutate(rank = row_number(desc(count))) ## Joining, by = &quot;cell_code&quot; rank_abundance %&gt;% ggplot(aes(x = rank, y = count, group = site_code)) + geom_point() + geom_line() + facet_wrap(~name) + coord_trans(y = &quot;log&quot;) + theme_bw() 5.1 Questions Why are some site names NA? do those sites not have names? Should 0 values be uploaded into Coleo? "],
["soil-invertebrates-1.html", "6 Soil invertebrates 6.1 Questions", " 6 Soil invertebrates # confirm that the only variable recorded here is &quot;abondance&quot; papillons$var %&gt;% unique %&gt;% {stopifnot(. == &quot;abondance&quot;)} ## are sites nested in cells? papillons %&gt;% select(site_code, cell_code) %&gt;% distinct %&gt;% group_by(cell_code) %&gt;% tally ## # A tibble: 11 x 2 ## cell_code n ## &lt;chr&gt; &lt;int&gt; ## 1 132_116 1 ## 2 135_104 1 ## 3 136_116 1 ## 4 137_107 2 ## 5 137_111 1 ## 6 139_103 1 ## 7 139_111 1 ## 8 141_108 1 ## 9 142_111 2 ## 10 145_102 2 ## 11 148_101 1 # yes, cells in sites rank_abundance &lt;- papillons %&gt;% filter(val&gt;0) %&gt;% left_join(select(cells, cell_code, name)) %&gt;% group_by(cell_code, name, site_code, taxa) %&gt;% summarize(total = sum(count)) %&gt;% mutate(rank = row_number(desc(total))) ## Joining, by = &quot;cell_code&quot; ## `summarise()` regrouping output by &#39;cell_code&#39;, &#39;name&#39;, &#39;site_code&#39; (override with `.groups` argument) rank_abundance %&gt;% ggplot(aes(x = rank, y = total, group = site_code)) + geom_point() + geom_line() + facet_wrap(~name) + coord_trans(y = &quot;log&quot;) + theme_bw() ## geom_path: Each group consists of only one observation. Do you need to adjust ## the group aesthetic? ## geom_path: Each group consists of only one observation. Do you need to adjust ## the group aesthetic? 6.1 Questions Why are some site names NA? do those sites not have names? Should 0 values be uploaded into Coleo? "],
["references.html", "References", " References "]
]
